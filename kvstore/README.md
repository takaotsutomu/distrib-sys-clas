# Fault-Tolerant Key/Value Storage System
Fault-tolerant key/value storage system built on top of the [Raft](https://en.wikipedia.org/wiki/Raft_(algorithm)) consensus protocol library. The system consists of three parts: Clerk, Service, and Raft. The service is a replicated state machine consisting of several key/value servers that use Raft for log replication. It continues to process client requests as long as a majority of the servers are alive and can communicate, in spite of other failures or network partitions. Clients can send three different RPCs to the key/value service: `Put(key: string, value: string)`, `Append(key: string, arg: string)`, and `Get(key: string)`. Keys and values are strings. `Put(key, value)` replaces the value for a particular key in the database, `Append(key, arg)` appends args to the key's value, and `Get(key)` fetches the current value for the key. A `Get` for a non-existent key returns an empty string. An `Append` to a non-existent key act just like `Put`. Each client communicates with the service through a `Clerk` with `Put`/`Append`/`Get` methods, in which the `Clerk` manages RPC interactions with the servers. 

The service arranges that application calls to `Clerk` `Put`/`Append`/`Get` methods be linearizable. If called one at a time, the `Put`/`Append`/`Get` methods act as if the system had only one copy of its state, and each call observes the modifications to the state implied by the preceding sequence of calls. A call observes the effect of all calls that have completed before the call starts. For concurrent calls, the return values and final state is the same as if the operations had been executed one at a time in some agreed order across all servers. It is guaranteed that the service does not to reply to clients using state that is not up to date and it recovers their state after failures in a way that preserves all acknowledged client updates.

The architecture of the system is as follows.
![kvstore_arch](https://github.com/takaotsutomu/distrib-sys-clas/blob/master/kvstore/kvstore_arch.png?raw=true)

```
Test: one client (3A) ...
  ... Passed --  15.1  5 22792 2850
Test: ops complete fast enough (3A) ...
  ... Passed --   4.2  3 10934    0
Test: many clients (3A) ...
  ... Passed --  16.5  5 49893 4830
Test: unreliable net, many clients (3A) ...
  ... Passed --  17.0  5  9044 1383
Test: concurrent append to same key, unreliable (3A) ...
  ... Passed --   1.2  3   258   52
Test: progress in majority (3A) ...
  ... Passed --   0.5  5    48    2
Test: no progress in minority (3A) ...
  ... Passed --   1.0  5   116    3
Test: completion after heal (3A) ...
  ... Passed --   1.0  5    62    3
Test: partitions, one client (3A) ...
  ... Passed --  22.4  5 13219 1026
Test: partitions, many clients (3A) ...
  ... Passed --  23.5  5 54140 3530
Test: restarts, one client (3A) ...
  ... Passed --  22.0  5 40080 1614
Test: restarts, many clients (3A) ...
  ... Passed --  22.0  5 137898 6417
Test: unreliable net, restarts, many clients (3A) ...
  ... Passed --  22.9  5  9834 1305
Test: restarts, partitions, many clients (3A) ...
  ... Passed --  26.7  5 78026 5097
Test: unreliable net, restarts, partitions, many clients (3A) ...
  ... Passed --  28.2  5  6637  764
Test: unreliable net, restarts, partitions, random keys, many clients (3A) ...
  ... Passed --  31.9  7 28712 2869
Test: InstallSnapshot RPC (3B) ...
  ... Passed --   2.1  3 10130   63
Test: snapshot size is reasonable (3B) ...
  ... Passed --   3.1  3  9106  800
Test: ops complete fast enough (3B) ...
  ... Passed --   3.8  3 10995    0
Test: restarts, snapshots, one client (3B) ...
  ... Passed --  22.0  5 53171 4214
Test: restarts, snapshots, many clients (3B) ...
  ... Passed --  22.4  5 401352 55729
Test: unreliable net, snapshots, many clients (3B) ...
  ... Passed --  17.0  5  9180 1376
Test: unreliable net, restarts, snapshots, many clients (3B) ...
  ... Passed --  22.4  5 10203 1421
Test: unreliable net, restarts, partitions, snapshots, many clients (3B) ...
  ... Passed --  28.3  5  7281  836
Test: unreliable net, restarts, partitions, snapshots, random keys, many clients (3B) ...
  ... Passed --  32.3  7 24792 2158
PASS
ok      lab4/kvraft     410.299s
```