# Fault-Tolerant Key/Value Storage System
Fault-tolerant key/value storage system built on top of the [Raft](https://en.wikipedia.org/wiki/Raft_(algorithm)) consensus protocol library. The system consists of three parts: Clerk, Service, and Raft. The service is a replicated state machine consisting of several key/value servers that use Raft for log replication. It continues to process client requests as long as a majority of the servers are alive and can communicate, in spite of other failures or network partitions. Clients can send three different RPCs to the key/value service: `Put(key: string, value: string)`, `Append(key: string, arg: string)`, and `Get(key: string)`. Keys and values are strings. `Put(key, value)` replaces the value for a particular key in the database, `Append(key, arg)` appends args to the key's value, and `Get(key)` fetches the current value for the key. A `Get` for a non-existent key returns an empty string. An `Append` to a non-existent key act just like `Put`. Each client communicates with the service through a `Clerk` with `Put`/`Append`/`Get` methods, in which the `Clerk` manages RPC interactions with the servers. 

The service arranges that application calls to `Clerk` `Put`/`Append`/`Get` methods be linearizable. If called one at a time, the `Put`/`Append`/`Get` methods act as if the system had only one copy of its state, and each call observes the modifications to the state implied by the preceding sequence of calls. A call observes the effect of all calls that have completed before the call starts. For concurrent calls, the return values and final state is the same as if the operations had been executed one at a time in some agreed order across all servers. It is guaranteed that the service does not to reply to clients using state that is not up to date and it recovers their state after failures in a way that preserves all acknowledged client updates.

The architecture of the system is as follows.
![kvstore_arch](https://github.com/takaotsutomu/distrib-sys-clas/blob/master/kvstore/kvstore_arch.png?raw=true)

```
Test: one client (3A) ...
  ... Passed --  15.2  5 12691 1515
Test: ops complete fast enough (3A) ...
  ... Passed --   6.3  3  9417    0
Test: many clients (3A) ...
  ... Passed --  15.6  5 36374 3772
Test: unreliable net, many clients (3A) ...
  ... Passed --  16.8  5  8902 1320
Test: concurrent append to same key, unreliable (3A) ...
  ... Passed --   1.2  3   258   52
Test: progress in majority (3A) ...
  ... Passed --   0.4  5    50    2
Test: no progress in minority (3A) ...
  ... Passed --   1.0  5   109    3
Test: completion after heal (3A) ...
  ... Passed --   1.0  5    68    3
Test: partitions, one client (3A) ...
  ... Passed --  22.8  5  9860  743
Test: partitions, many clients (3A) ...
  ... Passed --  23.5  5 33595 3129
Test: restarts, one client (3A) ...
  ... Passed --  21.8  5 26895 1851
Test: restarts, many clients (3A) ...
  ... Passed --  20.7  5 95872 5301
Test: unreliable net, restarts, many clients (3A) ...
  ... Passed --  21.4  5  9775 1347
Test: restarts, partitions, many clients (3A) ...
  ... Passed --  28.4  5 60415 3430
Test: unreliable net, restarts, partitions, many clients (3A) ...
  ... Passed --  28.5  5  7260  892
Test: unreliable net, restarts, partitions, random keys, many clients (3A) ...
  ... Passed --  31.9  7 27991 2544
Test: InstallSnapshot RPC (3B) ...
  ... Passed --   2.1  3  5735   63
Test: snapshot size is reasonable (3B) ...
  ... Passed --   3.2  3  7584  800
Test: ops complete fast enough (3B) ...
  ... Passed --   4.0  3  7720    0
Test: restarts, snapshots, one client (3B) ...
  ... Passed --  20.9  5 39854 3870
Test: restarts, snapshots, many clients (3B) ...
  ... Passed --  21.2  5 303127 41327
Test: unreliable net, snapshots, many clients (3B) ...
  ... Passed --  16.9  5  9369 1394
Test: unreliable net, restarts, snapshots, many clients (3B) ...
  ... Passed --  22.7  5 10070 1383
Test: unreliable net, restarts, partitions, snapshots, many clients (3B) ...
  ... Passed --  30.0  5  6548  657
Test: unreliable net, restarts, partitions, snapshots, random keys, many clients (3B) ...
  ... Passed --  32.3  7 24104 2016
PASS
ok      lab4/kvraft     410.461s
```